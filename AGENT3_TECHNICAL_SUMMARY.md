# üèÜ –ê–≥–µ–Ω—Ç 3: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - –ñ—É—Ä–Ω–∞–ª —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
–°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å –∂—É—Ä–Ω–∞–ª–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ (`journal`) —Å **–ñ–ï–°–¢–ö–û–ô —Å–∏—Å—Ç–µ–º–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ 24 —á–∞—Å–∞**, –ø–æ–ª–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á–µ—Ç–æ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π.

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è)

```
department_platform/
‚îú‚îÄ‚îÄ accounts/                    # ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ê–≥–µ–Ω—Ç 1)
‚îÇ   ‚îî‚îÄ‚îÄ models.py               # üîÑ –ò–ó–ú–ï–ù–ï–ù: –æ–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã get_average_grade() –∏ get_group_rank()
‚îú‚îÄ‚îÄ schedule/                    # ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ê–≥–µ–Ω—Ç 2)
‚îú‚îÄ‚îÄ journal/                     # üÜï –ù–û–í–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ admin.py                # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ apps.py
‚îÇ   ‚îú‚îÄ‚îÄ models.py               # 3 –º–æ–¥–µ–ª–∏: JournalEntry, JournalChangeLog, StudentStatistics
‚îÇ   ‚îú‚îÄ‚îÄ forms.py                # 4 —Ñ–æ—Ä–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ views.py                # 7 view-—Ñ—É–Ω–∫—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ urls.py                 # 6 URL-–º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ 0001_initial.py
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ base.html               # üîÑ –ò–ó–ú–ï–ù–ï–ù: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –∂—É—Ä–Ω–∞–ª–∞
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard_student.html   # üîÑ –ò–ó–ú–ï–ù–ï–ù: —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ü–µ–Ω–∫–∏ –∞–∫—Ç–∏–≤–Ω–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard_teacher.html   # üîÑ –ò–ó–ú–ï–ù–ï–ù: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ñ—É—Ä–Ω–∞–ª"
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dashboard_dean.html      # üîÑ –ò–ó–ú–ï–ù–ï–ù: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞"
‚îÇ   ‚îî‚îÄ‚îÄ journal/                # üÜï –ù–û–í–´–ï –®–ê–ë–õ–û–ù–´
‚îÇ       ‚îú‚îÄ‚îÄ journal_table.html       # –ì–ª–∞–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∂—É—Ä–Ω–∞–ª–∞
‚îÇ       ‚îú‚îÄ‚îÄ select_journal.html      # –í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã –∏ –ø—Ä–µ–¥–º–µ—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ student_view.html        # –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ü–µ–Ω–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–º
‚îÇ       ‚îú‚îÄ‚îÄ dean_view.html           # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –¥–µ–∫–∞–Ω–∞
‚îÇ       ‚îî‚îÄ‚îÄ change_log.html          # –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ department_platform/
‚îÇ   ‚îú‚îÄ‚îÄ settings.py             # üîÑ –ò–ó–ú–ï–ù–ï–ù: –¥–æ–±–∞–≤–ª–µ–Ω 'journal' –≤ INSTALLED_APPS
‚îÇ   ‚îî‚îÄ‚îÄ urls.py                 # üîÑ –ò–ó–ú–ï–ù–ï–ù: –¥–æ–±–∞–≤–ª–µ–Ω path('journal/', ...)
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (`journal/models.py`)

#### **JournalEntry** - –ó–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª–µ
```python
–ü–æ–ª—è:
- student: ForeignKey(Student)
- subject: ForeignKey(Subject)
- lesson_date: DateField - –¥–∞—Ç–∞ –∑–∞–Ω—è—Ç–∏—è
- lesson_time: TimeField - –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –ø–∞—Ä—ã
- lesson_type: CharField (LECTURE/PRACTICE/SRSP)
- grade: IntegerField(1-12, nullable) - –±–∞–ª–ª
- attendance_status: CharField(choices) - —Å—Ç–∞—Ç—É—Å –ø–æ—Å–µ—â–µ–Ω–∏—è
- locked_at: DateTimeField - –ö–†–ò–¢–ò–ß–ù–û! –≤—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- created_by: ForeignKey(Teacher)
- modified_by: ForeignKey(Teacher)

–ú–µ—Ç–æ–¥—ã:
- is_locked() ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (NOW >= locked_at)
- can_edit(user) ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- get_display_value() ‚Üí –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —è—á–µ–π–∫–∏

–í–∞–ª–∏–¥–∞—Ü–∏—è:
- –ë–∞–ª–ª –∏ –ù–ë –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ
- –ï—Å–ª–∏ –±–∞–ª–ª ‚Üí —Å—Ç–∞—Ç—É—Å = PRESENT
- –ï—Å–ª–∏ –ù–ë ‚Üí –±–∞–ª–ª = None

unique_together: ['student', 'subject', 'lesson_date', 'lesson_time']
```

#### **JournalChangeLog** - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
```python
–ü–æ–ª—è:
- entry: ForeignKey(JournalEntry)
- changed_by: ForeignKey(Teacher)
- changed_at: DateTimeField(auto_now_add=True)
- old_grade, old_attendance: —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- new_grade, new_attendance: –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- comment: TextField

–ú–µ—Ç–æ–¥—ã:
- get_change_description() ‚Üí —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
```

#### **StudentStatistics** - –ö—ç—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```python
–ü–æ–ª—è:
- student: OneToOneField(Student)
- overall_gpa: FloatField - –æ–±—â–∏–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª
- group_rank: IntegerField - —Ä–µ–π—Ç–∏–Ω–≥ –≤ –≥—Ä—É–ø–ø–µ
- attendance_percentage: FloatField
- total_lessons, attended_lessons: Integer
- subjects_data: JSONField - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º
- last_updated: DateTimeField

–ú–µ—Ç–æ–¥—ã:
- recalculate() ‚Üí –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- recalculate_group(group) ‚Üí –ø–µ—Ä–µ—Å—á–µ—Ç –¥–ª—è –≤—Å–µ–π –≥—Ä—É–ø–ø—ã
```

### 2. View-—Ñ—É–Ω–∫—Ü–∏–∏ (`journal/views.py`)

| –§—É–Ω–∫—Ü–∏—è | URL | –†–æ–ª–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|------|----------|
| `journal_view` | `/journal/` | –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å | –ì–ª–∞–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∂—É—Ä–Ω–∞–ª–∞ |
| `update_entry` | `/journal/entry/<id>/update/` | –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —è—á–µ–π–∫–∏ |
| `bulk_update` | `/journal/bulk-update/` | –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å | –ú–∞—Å—Å–æ–≤–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ |
| `change_log_view` | `/journal/changelog/` | –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å | –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| `student_journal_view` | `/journal/student/` | –°—Ç—É–¥–µ–Ω—Ç | –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –æ—Ü–µ–Ω–æ–∫ |
| `dean_journal_view` | `/journal/dean/` | –î–µ–∫–∞–Ω | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```python
# –í update_entry():
if entry.is_locked():
    messages.error(request, 'üîí –≠—Ç–∞ –∑–∞–ø–∏—Å—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞!')
    return redirect(...)
```

### 3. –°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ 24 —á–∞—Å–∞ (–ö–†–ò–¢–ò–ß–ù–û!)

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**
```python
def save(self, *args, **kwargs):
    if not self.locked_at:
        lesson_datetime = timezone.make_aware(
            timezone.datetime.combine(self.lesson_date, self.lesson_time)
        )
        self.locked_at = lesson_datetime + timedelta(hours=24)
    super().save(*args, **kwargs)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**
```python
def is_locked(self):
    if not self.locked_at:
        return False
    return timezone.now() >= self.locked_at
```

**–í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è:**
```html
{% if entry_data.is_locked %}
    <div class="locked-cell bg-secondary bg-opacity-10">
        <i class="bi bi-lock-fill"></i> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
    </div>
{% endif %}
```

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)

**–ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è:**
```python
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
old_grade = entry.grade
old_attendance = entry.attendance_status

# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
JournalChangeLog.objects.create(
    entry=entry,
    changed_by=teacher,
    old_grade=old_grade,
    old_attendance=old_attendance,
    new_grade=entry.grade,
    new_attendance=entry.attendance_status,
    comment=request.POST.get('comment', '')
)
```

### 5. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã:**
```python
journal_data = [
    {
        'student': student_obj,
        'entries': [
            {
                'entry': entry_obj,
                'is_locked': bool,
                'form': JournalEntryForm(...)
            },
            ...
        ]
    },
    ...
]
```

**–ú–∞—Å—Å–æ–≤–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ:**
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≤—ã–±–æ—Ä–æ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- –ß–µ–∫–±–æ–∫—Å "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö"
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º:**
```python
week_start = current_week.semester_start_date + timedelta(weeks=week_num - 1)
```

### 6. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç—É–¥–µ–Ω—Ç–∞

**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º:**
```python
subjects_data = {
    subject.id: {
        'subject': subject,
        'entries': [...],
        'avg_grade': float,
        'attendance_pct': float,
        'total_lessons': int,
        'attended': int
    }
}
```

**–¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è:**
- ‚úì –ó–µ–ª–µ–Ω—ã–π - –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª
- ‚úó –ö—Ä–∞—Å–Ω—ã–π - –ù–ë
- –ë–∞–ª–ª - badge —Å –æ—Ü–µ–Ω–∫–æ–π

### 7. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–µ–∫–∞–Ω–∞

**–¢—Ä–∏ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:**
1. **summary** - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–ø—ã
2. **at_risk** - —Å—Ç—É–¥–µ–Ω—Ç—ã –ø–æ–¥ —É–≥—Ä–æ–∑–æ–π (–±–∞–ª–ª < 4 –∏–ª–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å < 60%)

**–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:**
```python
group_stats = {
    'total_students': int,
    'avg_gpa': float,
    'avg_attendance': float,
    'subjects': [
        {
            'name': str,
            'avg_grade': float,
            'attendance_pct': float
        }
    ]
}
```

**–°—Ç—É–¥–µ–Ω—Ç—ã –ø–æ–¥ —É–≥—Ä–æ–∑–æ–π:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è: GPA < 4.0 OR attendance < 60%
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É —Å—Ç—É–¥–µ–Ω—Ç—É
- –ü—Ä–∏—á–∏–Ω—ã —Ä–∏—Å–∫–∞

### 8. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∂—É—Ä–Ω–∞–ª–∞:**
```python
stats, _ = StudentStatistics.objects.get_or_create(student=entry.student)
stats.recalculate()
```

**–ü–µ—Ä–µ—Å—á–µ—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã:**
```python
StudentStatistics.recalculate_group(group)
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Account:**
```python
# –í accounts/models.py:
def get_average_grade(self):
    from journal.models import StudentStatistics
    stats, _ = StudentStatistics.objects.get_or_create(student=self)
    return stats.overall_gpa

def get_group_rank(self):
    from journal.models import StudentStatistics
    stats, _ = StudentStatistics.objects.get_or_create(student=self)
    return stats.group_rank
```

### 9. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**
- –ü–æ –¥–∞—Ç–µ (–æ—Ç/–¥–æ)
- –ü–æ —Å—Ç—É–¥–µ–Ω—Ç—É
- –ü–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ 100 –∑–∞–ø–∏—Å–µ–π

**–§–æ—Ä–º–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
```
[25.12.2024 14:30:00] –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ò–≤–∞–Ω–æ–≤ –ò.–ò. –∏–∑–º–µ–Ω–∏–ª 
–æ—Ü–µ–Ω–∫—É —Å—Ç—É–¥–µ–Ω—Ç–∞ –ü–µ—Ç—Ä–æ–≤ –ü.–ü.: –±–∞–ª–ª: 7 ‚Üí 9
```

### 10. –§–æ—Ä–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

**JournalEntryForm:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–µ–Ω–∏—è –±–∞–ª–ª–∞ –∏ –ù–ë
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–µ–π –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö

**BulkGradeForm:**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω –ª–∏–±–æ –±–∞–ª–ª, –ª–∏–±–æ —Å—Ç–∞—Ç—É—Å

**JournalFilterForm:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –ø–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é

**ChangeLogFilterForm:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ –≥—Ä—É–ø–ø–µ
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É

### 11. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**Select related / Prefetch related:**
```python
entries = JournalEntry.objects.filter(
    student=student
).select_related('subject').order_by('lesson_date')
```

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
- StudentStatistics —Ö—Ä–∞–Ω–∏—Ç –ø—Ä–µ–¥—Ä–∞—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∂—É—Ä–Ω–∞–ª–∞
- subjects_data –≤ JSON –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏

### 12. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

**JournalEntryAdmin:**
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (üîí –∏–ª–∏ ‚úì)
- –í—Å–µ –ø–æ–ª—è readonly –µ—Å–ª–∏ is_locked()
- –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–µ, –ø—Ä–µ–¥–º–µ—Ç—É, —Å—Ç–∞—Ç—É—Å—É
- Search –ø–æ —Å—Ç—É–¥–µ–Ω—Ç–∞–º

**JournalChangeLogAdmin:**
- Readonly –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π (–ª–æ–≥–∏ –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)
- –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–µ –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é

**StudentStatisticsAdmin:**
- Action "–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É" –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞

---

## üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏

```
User ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ> Student ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ> JournalEntry ‚îÄ‚îÄ> Subject
       ‚îÇ              ‚îî‚îÄ‚îÄ> StudentStatistics
       ‚îî‚îÄ‚îÄ> Teacher ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îî‚îÄ‚îÄ> JournalChangeLog

JournalEntry ‚îÄ‚îÄ> JournalChangeLog (1 to many)
JournalEntry ‚îÄ‚îÄ> StudentStatistics (trigger recalculation)
```

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ Django –º–æ–¥—É–ª–∏.

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (settings.py)

```python
INSTALLED_APPS = [
    ...
    'journal.apps.JournalConfig',  # –î–û–ë–ê–í–õ–ï–ù–û
]
```

---

## üîÄ URL-–º–∞—Ä—à—Ä—É—Ç—ã (urls.py)

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –≥–ª–∞–≤–Ω—ã–π urls.py:**
```python
path('journal/', include('journal.urls')),
```

**–í journal/urls.py (6 –º–∞—Ä—à—Ä—É—Ç–æ–≤):**
```python
app_name = 'journal'

urlpatterns = [
    path('', views.journal_view, name='journal_view'),
    path('entry/<int:entry_id>/update/', views.update_entry, name='update_entry'),
    path('bulk-update/', views.bulk_update, name='bulk_update'),
    path('changelog/', views.change_log_view, name='change_log'),
    path('student/', views.student_journal_view, name='student_view'),
    path('dean/', views.dean_journal_view, name='dean_view'),
]
```

---

## üé® UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –¢–∞–±–ª–∏—Ü–∞ –∂—É—Ä–Ω–∞–ª–∞
```html
<table class="table table-bordered journal-table">
    <thead>
        <tr>
            <th>–°—Ç—É–¥–µ–Ω—Ç</th>
            <th>–î–µ–Ω—å 1</th>
            <th>–î–µ–Ω—å 2</th>
            ...
        </tr>
    </thead>
    <tbody>
        {% for row in journal_data %}
            <tr>
                <td>{{ row.student.user.get_full_name }}</td>
                {% for entry in row.entries %}
                    <td class="{% if entry.is_locked %}bg-secondary{% endif %}">
                        <!-- –§–æ—Ä–º–∞ –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —è—á–µ–π–∫–∞ -->
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>
```

### –ú–∞—Å—Å–æ–≤–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ)
```html
<div class="modal" id="bulkUpdateModal">
    <!-- –í—ã–±–æ—Ä –¥–Ω—è, —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, –±–∞–ª–ª–∞/—Å—Ç–∞—Ç—É—Å–∞ -->
</div>
```

### –°—Ç—É–¥–µ–Ω—Ç - –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º
```html
{% for subject_data in subjects_data %}
    <div class="card">
        <div class="card-header">
            {{ subject_data.subject.name }}
            <badge>–°—Ä. –±–∞–ª–ª: {{ subject_data.avg_grade }}</badge>
        </div>
        <table>...</table>
    </div>
{% endfor %}
```

### –î–µ–∫–∞–Ω - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
```html
<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="row">
    <div class="col-md-4">
        <card>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: {{ group_stats.avg_gpa }}</card>
    </div>
    ...
</div>

<!-- –°—Ç—É–¥–µ–Ω—Ç—ã –ø–æ–¥ —É–≥—Ä–æ–∑–æ–π -->
<table class="table-danger">
    {% for item in at_risk_students %}
        <tr>
            <td>{{ item.student }}</td>
            <td>{{ item.stats.overall_gpa }}</td>
            <td>{{ item.reason }}</td>
        </tr>
    {% endfor %}
</table>
```

---

## üß™ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–ª—è –∑–∞–ø—É—Å–∫–∞)

**–ú–∏–Ω–∏–º—É–º –¥–ª—è —Ä–∞–±–æ—Ç—ã:**
1. –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (ScheduleSlot) –¥–ª—è –≥—Ä—É–ø–ø—ã –∏ –ø—Ä–µ–¥–º–µ—Ç–∞
2. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç JournalEntry –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∂—É—Ä–Ω–∞–ª–∞
3. –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç –æ—Ü–µ–Ω–∫–∏
4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ö–æ–º–∞–Ω–¥—ã –º–∏–≥—Ä–∞—Ü–∏–π:**
```bash
python manage.py makemigrations journal
python manage.py migrate journal
```

---

## üöÄ –¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤

### –î–ª—è –ê–≥–µ–Ω—Ç–∞ 4 (–¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–ª–∞–Ω—ã/–£—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã):
```python
# –í Subject –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
syllabus = models.FileField(upload_to='syllabi/')
course_materials = models.ManyToManyField(CourseMaterial)

# –°–≤—è–∑–∞—Ç—å —Å JournalEntry:
topic = models.CharField(max_length=200, blank=True)  # —Ç–µ–º–∞ –∑–∞–Ω—è—Ç–∏—è
homework = models.TextField(blank=True)  # –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ
```

### –î–ª—è –ê–≥–µ–Ω—Ç–∞ 5 (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏):
```python
# –≠–∫–∑–∞–º–µ–Ω—ã –∏ –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏:
class Exam(models.Model):
    student = ForeignKey(Student)
    subject = ForeignKey(Subject)
    exam_type = CharField(choices=['MIDTERM', 'FINAL'])
    grade = IntegerField(1-12)

# –°–≤—è–∑–∞—Ç—å —Å StudentStatistics –¥–ª—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ GPA
```

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞

- [x] –ú–æ–¥–µ–ª–∏ –∂—É—Ä–Ω–∞–ª–∞ —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] –ü—Ä–∞–≤–∏–ª–æ 24 —á–∞—Å–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
- [x] –ú–∞—Å—Å–æ–≤–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç—É–¥–µ–Ω—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ü–µ–Ω–∫–∏
- [x] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–µ–∫–∞–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É
- [x] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å accounts/models.py –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- [x] –ù–∞–≤–∏–≥–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [x] –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è (responsive —Ç–∞–±–ª–∏—Ü—ã)

---

## üîß –ö–†–ò–¢–ò–ß–ù–´–ï –ü–†–ê–í–ò–õ–ê (–ù–ï –ù–ê–†–£–®–ê–¢–¨!)

### 1. –ü—Ä–∞–≤–∏–ª–æ 24 —á–∞—Å–æ–≤
```python
# –≠–¢–û –ü–†–ê–í–ò–õ–û –ù–ï –û–¢–ú–ï–ù–Ø–ï–¢–°–Ø –ù–ò–ö–û–ì–î–ê!
def is_locked(self):
    if not self.locked_at:
        return False
    return timezone.now() >= self.locked_at

# –î–∞–∂–µ –¥–µ–∫–∞–Ω –Ω–µ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
def can_edit(self, user):
    if self.is_locked():
        return False  # –ñ–ï–°–¢–ö–ê–Ø –ë–õ–û–ö–ò–†–û–í–ö–ê
    ...
```

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –±–∞–ª–ª/–ù–ë
```python
# –í –º–æ–¥–µ–ª–∏:
def save(self, *args, **kwargs):
    if self.grade is not None and self.grade > 0:
        self.attendance_status = 'PRESENT'  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    elif self.attendance_status != 'PRESENT':
        self.grade = None  # –û—á–∏—Å—Ç–∏—Ç—å –±–∞–ª–ª
```

### 3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –ö–ê–ñ–î–û–ï –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–æ
JournalChangeLog.objects.create(...)  # –ë–ï–ó –ò–°–ö–õ–Æ–ß–ï–ù–ò–ô
```

### 4. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```python
with transaction.atomic():
    entry.save()
    log.create()
    stats.recalculate()
```

---

## üìù –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:** 15
- **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:** 6
- **–ù–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π:** 3
- **View-—Ñ—É–Ω–∫—Ü–∏–π:** 7
- **URL-–º–∞—Ä—à—Ä—É—Ç–æ–≤:** 6
- **–®–∞–±–ª–æ–Ω–æ–≤:** 5
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~3800

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞!** ‚úÖ

---

## üéØ –ß—Ç–æ –ø–æ–ª—É—á–∏–ª–∏

1. ‚úÖ **–ñ–µ—Å—Ç–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ 24 —á–∞—Å–∞** - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Å–ª–µ –¥–µ–¥–ª–∞–π–Ω–∞
2. ‚úÖ **–ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
3. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - GPA, —Ä–µ–π—Ç–∏–Ω–≥–∏, –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
4. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏** - –±–∞–ª–ª –∏ –ù–ë –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ
5. ‚úÖ **–ú–∞—Å—Å–æ–≤–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ** - –±—ã—Å—Ç—Ä–æ–µ –ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
6. ‚úÖ **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –ø–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
7. ‚úÖ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–µ–∫–∞–Ω–∞** - –≤—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
8. ‚úÖ **–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ—Ö —Ä–æ–ª–µ–π

**–ú–æ–¥—É–ª—å –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!** üöÄ