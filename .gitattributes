#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Git workflow —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –º–æ–¥—É–ª—è–º

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git workflow –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞..."

# 1. –°–æ–∑–¥–∞–µ–º .gitattributes –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
cat > .gitattributes << 'EOF'
# Auto detect text files and perform LF normalization
* text=auto

# Python files
*.py text eol=lf
*.pyc binary

# Web files
*.html text eol=lf
*.css text eol=lf
*.js text eol=lf

# Static files
*.png binary
*.jpg binary
*.gif binary
*.ico binary
EOF

# 2. –°–æ–∑–¥–∞–µ–º CODEOWNERS –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ review
cat > .github/CODEOWNERS << 'EOF'
# –ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ–π –º–æ–¥—É–ª—å

# Accounts module
/accounts/ @team-accounts
/templates/accounts/ @team-accounts

# Chat module
/chat/ @team-chat
/templates/chat/ @team-chat

# Journal module
/journal/ @team-journal
/templates/journal/ @team-journal

# Schedule module
/schedule/ @team-schedule
/templates/schedule/ @team-schedule

# News module
/news/ @team-news
/templates/news/ @team-news

# Frontend
/static/ @team-frontend
/templates/base.html @team-frontend
EOF

# 3. –°–æ–∑–¥–∞–µ–º —É–¥–æ–±–Ω—ã–µ –∞–ª–∏–∞—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–µ—Ç–∫–∞–º–∏
git config alias.feature-accounts 'checkout feature/accounts'
git config alias.feature-chat 'checkout feature/chat'
git config alias.feature-journal 'checkout feature/journal'
git config alias.feature-schedule 'checkout feature/schedule'
git config alias.feature-news 'checkout feature/news'
git config alias.feature-frontend 'checkout feature/frontend'

# 4. –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ feature-–≤–µ—Ç–∫–∏ –∏–∑ main
for branch in feature/accounts feature/chat feature/journal feature/schedule feature/news feature/frontend; do
    echo "üì¶ –û–±–Ω–æ–≤–ª—è–µ–º $branch..."
    git checkout $branch 2>/dev/null || git checkout -b $branch
    git merge main --no-edit
done

# 5. –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ main
git checkout main

echo "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "  git feature-accounts  - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–µ—Ç–∫—É accounts"
echo "  git feature-chat      - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–µ—Ç–∫—É chat"
echo "  git feature-journal   - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–µ—Ç–∫—É journal"
echo "  git feature-schedule  - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–µ—Ç–∫—É schedule"
echo "  git feature-news      - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–µ—Ç–∫—É news"
echo "  git feature-frontend  - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–µ—Ç–∫—É frontend"
echo ""
echo "üìù –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã:"
echo "  1. –†–∞–±–æ—Ç–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–∞–¥ —Ñ–∞–π–ª–∞–º–∏ —Å–≤–æ–µ–≥–æ –º–æ–¥—É–ª—è"
echo "  2. –î–µ–ª–∞–π—Ç–µ pull request –∏–∑ feature/* –≤ develop"
echo "  3. –ò–∑ develop –≤ main —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ review"